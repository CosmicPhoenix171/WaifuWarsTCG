<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>Waifu Wars TCG – Emotional Strategy Card Game</title>
   <meta name="description" content="Waifu Wars TCG: fast tactical anime card game where Bonds, moods, and archetypes forge dramatic comebacks." />
   <meta name="color-scheme" content="dark light" />
   <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%236d5dfc'/%3E%3Cpath d='M20 38c6 6 12 6 18 0 5-5 5-13 0-18-4-4-10-4-14 0-5 5-5 13 0 18z' fill='%23fff'/%3E%3C/svg%3E" />
  <meta name="description" content="Waifu Wars TCG — a sleek, modern anime card battler with emotional mechanics, bond meters, and dramatic trope moments." />
  <meta property="og:title" content="Waifu Wars TCG" />
  <meta property="og:description" content="Tactical anime card battler with bonds, mood states, and archetype matchups." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#ee2e8b" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
  <header class="site-header">
    <div class="container nav">
      <div class="brand">
        <span class="logo">Waifu Wars</span>
        <span class="tag">TCG</span>
      </div>
      <nav class="menu" aria-label="Primary">
        <a href="#battle-loop">Battle Loop</a>
        <a href="#emotional-engine">Emotional Engine</a>
        <a href="#features">Features</a>
        <a href="#join">Join</a>
      </nav>
    </div>
  </header>

  <main id="main">
    <section class="hero">
      <div class="container hero-inner">
        <div class="hero-copy">
          <h1 class="title">Outplay With Emotion</h1>
          <p class="subtitle">A tactical anime card battler where Bonds, mood swings, and archetype matchups decide every duel.</p>
          <div class="cta-row">
            <a class="btn btn-primary" href="#battle-loop">Learn How To Play</a>
            <a class="btn btn-ghost" href="#features">See Features</a>
          </div>
          <div class="hero-highlights">
            <div class="chip">Bonds-powered abilities</div>
            <div class="chip">Neutral → Dere → Extreme</div>
            <div class="chip">Passion • Stoic • Heart</div>
          </div>
        </div>
        <div class="hero-art" aria-hidden="true">
          <div class="card-mock one"></div>
          <div class="card-mock two"></div>
          <div class="card-mock three"></div>
        </div>
      </div>
    </section>

    <section id="battle-loop" class="battle-loop">
      <div class="container">
        <h2 class="section-title">Battle Loop Snapshot</h2>
        <ol class="loop">
          <li><strong>Draw Phase:</strong> Draw 1 card; fire start-of-turn triggers.</li>
          <li><strong>Main Phase:</strong> Summon up to 3 waifus, play Support, set Traps.</li>
          <li><strong>Battle Phase:</strong> Declare attacks; Affection damage & bond checks.</li>
          <li><strong>End Phase:</strong> Resolve lingering effects, update Bonds & mood.</li>
        </ol>
        <p class="round-note">Round ends if you lose three waifus or finish with none in play. Simultaneous knockout? Narrative privilege awards you the win.</p>
      </div>
    </section>

    <section id="emotional-engine" class="engine">
      <div class="container">
        <h2 class="section-title">Emotional Engine</h2>
        <div class="engine-grid">
          <div class="engine-card">
            <h3>Affection (HP)</h3>
            <p>Each waifu’s durability. Drop to 0 and she exits—unless a Final Stand bends fate.</p>
          </div>
          <div class="engine-card">
            <h3>Bonds</h3>
            <p>Relationship meter fueling Confessions, meltdowns, and clutch survival effects.</p>
          </div>
          <div class="engine-card">
            <h3>Mood States</h3>
            <p>Neutral → Dere → Extreme escalations unlock power spikes & alternate art moments.</p>
          </div>
          <div class="engine-card">
            <h3>Bond Cards</h3>
            <p>Create Lover / Rival / Mentor links for shared triggers and combo supers.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="features" class="features">
      <div class="container">
        <h2 class="section-title">What Makes It Different</h2>
        <div class="grid">
          <article class="feature">
            <h3>Emotion-Driven Combat</h3>
            <p>Build Bonds, trigger Confessions, and pivot moods to flip the battlefield in your favor.</p>
          </article>
          <article class="feature">
            <h3>Clear Archetypes</h3>
            <p>Tsundere strikes, Kuudere control, Yandere deletion—distinct playstyles that stay balanced.</p>
          </article>
          <article class="feature">
            <h3>Collect • Trade • Flex</h3>
            <p>Open packs with animated reveals, complete sets, and trade safely in the hub.</p>
          </article>
          <article class="feature">
            <h3>Made for Web & Mobile</h3>
            <p>Responsive UI, touch-friendly layouts, and readable typography out of the box.</p>
          </article>
        </div>
      </div>
    </section>

    <section id="cards" class="cards-gallery">
      <div class="container">
        <h2 class="section-title">Card Spotlight</h2>
        <p class="cards-intro">Preview a sampling of Waifu archetypes—each colorful personality brings unique stats, moods, and tags to weave into your bond-driven strategy.</p>
        <div id="cards-status" class="cards-status" role="status" aria-live="polite">Loading card previews…</div>
        <div id="cards-grid" class="cards-grid" aria-live="polite"></div>
      </div>
    </section>

    <section class="callouts">
      <div class="container">
        <div class="callout">
          <div class="callout-copy">
            <h3>Meet the Archetypes</h3>
            <p>Learn the macro families—Passion Surge, Stoic Control, Heart Guard—and how they create soft matchups.</p>
            <a class="btn btn-secondary" href="#features">Explore Archetypes</a>
          </div>
        </div>
        <div class="callout alt">
          <div class="callout-copy">
            <h3>Build Your First Deck</h3>
            <p>Start with a Tsundere reactive shell or a Deredere support core—simple rules, deep strategy.</p>
            <a class="btn btn-secondary" href="#cards">See Cards</a>
          </div>
        </div>
      </div>
    </section>

  <section id="join" class="cta">
      <div class="container">
        <h2 class="section-title">Join The Journey</h2>
        <p>Follow development and get notified when the alpha opens.</p>
        <div class="cta-row">
          <a class="btn btn-primary" href="#">Join Waitlist</a>
          <a class="btn btn-ghost" href="#features">Learn More</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>© <span id="year"></span> Waifu Wars TCG</div>
      <div class="footer-links">
  <a href="#join">Contact</a>
        <a href="https://github.com/CosmicPhoenix171/WaifuWarsTCG" target="_blank" rel="noopener">GitHub</a>
      </div>
    </div>
  </footer>

  <script type="module">
    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    const cardsGrid = document.getElementById('cards-grid');
    const cardsStatus = document.getElementById('cards-status');

    function capitalize(word = '') {
      return word.charAt(0).toUpperCase() + word.slice(1);
    }

    function formatSentences(text) {
      if (!text) return [];
      return text
        .split(/(?<=[.!?])\s+/)
        .map(line => line.trim())
        .filter(Boolean);
    }

    function formatBonds(bonds) {
      if (!bonds) return '—';
      const start = typeof bonds.start === 'number' ? bonds.start : null;
      const max = typeof bonds.max === 'number' ? bonds.max : null;
      if (start !== null && max !== null) return `${start} / ${max}`;
      if (max !== null) return `${max}`;
      return '—';
    }

    function formatMood(mood) {
      if (!mood) return '— / —';
      const dere = mood.dere ?? '—';
      const extreme = mood.extreme ?? '—';
      return `${dere} / ${extreme}`;
    }

    async function loadCards() {
      if (!cardsGrid || !cardsStatus) return;
      try {
        cardsStatus.hidden = false;
        cardsStatus.textContent = 'Loading card previews…';
        const res = await fetch('cards/index/by-type.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`Request failed: ${res.status}`);
        const data = await res.json();
        const waifus = Array.isArray(data?.waifu) ? data.waifu : [];

        if (!waifus.length) {
          cardsStatus.textContent = 'Card previews are coming soon.';
          return;
        }

        cardsStatus.textContent = '';
        cardsStatus.hidden = true;
        const frag = document.createDocumentFragment();

        const customCardBack = 'assets/images/card-back.png';
        const fallbackCardBack = 'assets/images/card-back-default.svg';

        for (const card of waifus) {
          const rarity = (card.rarity || 'common').toLowerCase();
          const typeLabel = card.type ? capitalize(card.type) : 'Waifu';
          const abilityLines = formatSentences(card.text);
          const flavor = card.flavor ? card.flavor.replace(/^“|”$/g, '') : '';
          const moodDisplay = formatMood(card.mood);
          const bondsDisplay = formatBonds(card.bonds);
          const artDefault = card.art?.default;
          const hasArt = Boolean(artDefault);
          const artRole = hasArt ? `${card.name} artwork` : 'Card back artwork';
          const artMarkup = hasArt
            ? `<img src="${artDefault}" alt="">`
            : `<img src="${customCardBack}" alt="Waifu Wars card back" class="card-art-img-back" onerror="this.onerror=null;this.src='${fallbackCardBack}';">`;

          const article = document.createElement('article');
          article.className = 'card-display';
          article.dataset.rarity = rarity;
          if (card.archetype) {
            article.dataset.archetype = card.archetype.toLowerCase();
          }
          article.setAttribute('tabindex', '0');
          article.setAttribute('role', 'button');
          article.setAttribute('aria-label', `View ${card.name} details`);

          const tagsHtml = (card.tags || [])
            .map(tag => `<span class="card-tag">${tag}</span>`)
            .join('');

          const abilitiesHtml = abilityLines.length
            ? abilityLines.map(line => `<li>${line}</li>`).join('')
            : '<li class="card-ability-empty">Ability text coming soon.</li>';

          const flavorHtml = flavor
            ? `<p class="card-flavor">“${flavor}”</p>`
            : '';

          article.innerHTML = `
            <div class="card-frame">
              <header class="card-header">
                <span class="card-rarity-badge">${(card.rarity || 'common').toUpperCase()}</span>
                <h3 class="card-title">${card.name}</h3>
                <span class="card-aff-chip"><span aria-hidden="true">❤</span><span class="sr-only">Affection</span>${card.affection ?? '—'}</span>
              </header>
              <div class="${hasArt ? 'card-art' : 'card-art card-art--back'}" role="img" aria-label="${artRole}">
                ${artMarkup}
              </div>
              <div class="card-type-row">
                <span class="card-type-label">${card.archetype ? `${typeLabel} — ${card.archetype}` : typeLabel}</span>
                <span class="card-archetype-chip">${(card.archetype || typeLabel).toUpperCase()}</span>
              </div>
              <div class="card-text-box">
                <ul class="card-abilities">
                  ${abilitiesHtml}
                </ul>
                ${flavorHtml}
              </div>
              <dl class="card-statline">
                <div>
                  <dt>Affection</dt>
                  <dd>${card.affection ?? '—'}</dd>
                </div>
                <div>
                  <dt>Bonds</dt>
                  <dd>${bondsDisplay}</dd>
                </div>
                <div>
                  <dt>Mood</dt>
                  <dd>${moodDisplay}</dd>
                </div>
              </dl>
              <div class="card-tags" aria-label="Card tags">
                ${tagsHtml || '<span class="card-tag card-tag-empty">No tags yet</span>'}
              </div>
              <footer class="card-footer">Set ${card.set || 'TBA'} • ${card.id?.toUpperCase() || ''}</footer>
            </div>
          `;

          // Add click handler for modal
          article.addEventListener('click', () => openCardModal(card, rarity));
          article.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              openCardModal(card, rarity);
            }
          });

          frag.appendChild(article);
        }

        cardsGrid.appendChild(frag);
        
        // Auto-resize text to fit in text boxes
        requestAnimationFrame(() => {
          document.querySelectorAll('.card-text-box').forEach(textBox => {
            const abilities = textBox.querySelector('.card-abilities');
            if (!abilities) return;
            
            let fontSize = 0.88; // Start with default size in rem
            const minSize = 0.65;
            const step = 0.02;
            
            // Reset to default
            abilities.style.fontSize = fontSize + 'rem';
            
            // Reduce font size until content fits
            while (textBox.scrollHeight > textBox.clientHeight && fontSize > minSize) {
              fontSize -= step;
              abilities.style.fontSize = fontSize + 'rem';
            }
          });
        });
      } catch (err) {
        cardsStatus.textContent = 'Could not load cards right now. Try refreshing in a moment.';
        cardsStatus.hidden = false;
        console.error(err);
      }
    }

    // Card modal functionality
    function openCardModal(card, rarity) {
      const modal = document.getElementById('card-modal');
      if (!modal) {
        createCardModal();
        openCardModal(card, rarity);
        return;
      }

      const modalContent = modal.querySelector('.modal-card-wrapper');
      const typeLabel = card.type ? capitalize(card.type) : 'Waifu';
      const abilityLines = formatSentences(card.text);
      const flavor = card.flavor ? card.flavor.replace(/^"|"$/g, '') : '';
      const moodDisplay = formatMood(card.mood);
      const bondsDisplay = formatBonds(card.bonds);
      const artDefault = card.art?.default;

      const tagsHtml = (card.tags || [])
        .map(tag => `<span class="card-tag">${tag}</span>`)
        .join('');

      const abilitiesHtml = abilityLines.length
        ? abilityLines.map(line => `<li>${line}</li>`).join('')
        : '<li class="card-ability-empty">Ability text coming soon.</li>';

      const flavorHtml = flavor
        ? `<p class="card-flavor">"${flavor}"</p>`
        : '';

      const archetypeAttr = card.archetype ? ` data-archetype="${card.archetype.toLowerCase()}"` : '';
      
      modalContent.innerHTML = `
        <article class="card-display" data-rarity="${rarity}"${archetypeAttr}>
          <div class="card-frame">
            <header class="card-header">
              <span class="card-rarity-badge">${(card.rarity || 'common').toUpperCase()}</span>
              <h3 class="card-title">${card.name}</h3>
              <span class="card-aff-chip"><span aria-hidden="true">❤</span><span class="sr-only">Affection</span>${card.affection ?? '—'}</span>
            </header>
            <div class="card-art" role="img" aria-label="${card.name} artwork">
              ${artDefault ? `<img src="${artDefault}" alt="">` : '<div class="card-art-placeholder"></div>'}
            </div>
            <div class="card-type-row">
              <span class="card-type-label">${card.archetype ? `${typeLabel} — ${card.archetype}` : typeLabel}</span>
              <span class="card-archetype-chip">${(card.archetype || typeLabel).toUpperCase()}</span>
            </div>
            <div class="card-text-box">
              <ul class="card-abilities">
                ${abilitiesHtml}
              </ul>
              ${flavorHtml}
            </div>
            <dl class="card-statline">
              <div>
                <dt>Affection</dt>
                <dd>${card.affection ?? '—'}</dd>
              </div>
              <div>
                <dt>Bonds</dt>
                <dd>${bondsDisplay}</dd>
              </div>
              <div>
                <dt>Mood</dt>
                <dd>${moodDisplay}</dd>
              </div>
            </dl>
            <div class="card-tags" aria-label="Card tags">
              ${tagsHtml || '<span class="card-tag card-tag-empty">No tags yet</span>'}
            </div>
            <footer class="card-footer">Set ${card.set || 'TBA'} • ${card.id?.toUpperCase() || ''}</footer>
          </div>
        </article>
      `;

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Focus the close button for accessibility
      setTimeout(() => {
        const closeBtn = modal.querySelector('.modal-close');
        if (closeBtn) closeBtn.focus();
      }, 100);
    }

    function closeCardModal() {
      const modal = document.getElementById('card-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    function createCardModal() {
      const modal = document.createElement('div');
      modal.id = 'card-modal';
      modal.className = 'card-modal';
      modal.setAttribute('role', 'dialog');
      modal.setAttribute('aria-modal', 'true');
      modal.setAttribute('aria-labelledby', 'modal-card-title');

      modal.innerHTML = `
        <div class="modal-overlay"></div>
        <div class="modal-content">
          <button class="modal-close" aria-label="Close card preview">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <div class="modal-card-wrapper"></div>
        </div>
      `;

      document.body.appendChild(modal);

      // Close handlers
      modal.querySelector('.modal-overlay').addEventListener('click', closeCardModal);
      modal.querySelector('.modal-close').addEventListener('click', closeCardModal);
      
      modal.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeCardModal();
        }
      });
    }

    loadCards();
  </script>
</body>
</html>
